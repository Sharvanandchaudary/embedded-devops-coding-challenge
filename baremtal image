# Optional but recommended
rm -rf /var/lib/cloud/
truncate -s 0 /etc/machine-id
cloud-init clean



‚úÖ Fix: Correct Way to Create Image from Powered-Off Instance
‚úÖ Step 1: Confirm Instance Is Shut Down
bash
Copy
Edit
openstack server stop <instance-name>
Wait 10‚Äì20 seconds:

bash
Copy
Edit
openstack server show <instance-name> -f value -c status
# Should return: SHUTOFF
‚úÖ Step 2: Create the Image Again
bash
Copy
Edit
openstack server image create --name rhel86-root-enabled <instance-name>
Wait ~1‚Äì2 minutes and check:

bash
Copy
Edit
openstack image show rhel86-root-enabled -f yaml | grep size
If still 0, continue below.

‚úÖ Step 3: Is Your Instance Booted from a Volume?
Check if the instance is booted from volume (Cinder) instead of image (Glance):

bash
Copy
Edit
openstack server show <instance-name> -f json | jq '.os-extended-volumes:volumes_attached'
If there‚Äôs a volume ID there ‚Üí ‚ùó You‚Äôre using a volume-backed instance.

In that case, server image create will not include the actual disk ‚Äî it creates an image placeholder with no data.

‚úÖ Solutions Based on Root Cause
Cause	Fix
Instance still running	Shut it down before image creation
Volume-backed instance	‚úÖ Use glance image-create --file <exported>.qcow2 instead
Image still building	Wait and retry openstack image show
Need file-based image	Use Packer or manually download with openstack server backup + qemu-img convert

üîß Workaround: Extract Image via qemu-img or nova image-download
If you're stuck with a volume-backed instance:

Boot it

SSH in

Create .qcow2 via dd or Packer

Upload using:

bash
Copy
Edit
glance image-create --file rhel86-root-fixed.qcow2 \
  --disk-format qcow2 \
  --container-format bare \
  --min-disk 40 \
  --property hw_firmware_type=uefi \
  --property hw_disk_bus=virtio \
  --property hw_boot_menu=true \
  --name rhel86-root-final
Let me know:

Did your instance boot from volume or image?

Want help extracting and packaging the disk manually?





























# Shut down
sudo poweroff

openstack image set rhel86-root-enabled \
  --property hw_firmware_type=uefi \
  --property hw_disk_bus=virtio \
  --property hw_boot_menu=true \
  --property os_distro=rhel8 \
  --property os_type=linux


openstack image set rhel86-iso-uefi \
  --property hw_firmware_type=uefi \
  --property hw_disk_bus=virtio \
  --property hw_boot_menu=true

openstack image show rhel86-iso-uefi -f yaml | grep -E 'hw_firmware_type|hw_disk_bus|hw_boot_menu'

+
vsaravan@sjcvl-ghrunner1:~$ openstack image show rhel86-iso-uefi -f yaml
checksum: 19501666f46df6b5472db1254e86a339
container_format: bare
created_at: '2025-07-31T23:59:44Z'
disk_format: qcow2
file: /v2/images/7b161dc8-016b-4535-b370-821ba7d7787f/file
id: 7b161dc8-016b-4535-b370-821ba7d7787f
min_disk: 100
min_ram: 0
name: rhel86-iso-uefi
owner: dcfb102e7fc940c39c0c21c48d77d3cf
properties:
  os_hash_algo: sha512
  os_hash_value: 03589784e00d673f79d92615fe468fdafa955cfe9225b1c6f89dee82e4f374ddccbd5239c53dd6607a10766c80ed2d39e9f1b850de3f69bf5bb32451f5190c24
  os_hidden: false
  stores: default_backend
protected: false
schema: /v2/schemas/image
size: 832438272
status: active
tags: []
updated_at: '2025-08-01T00:00:16Z'
virtual_size: 10737418240
visibility: private




vsaravan@sjcvl-ghrunner1:~$ openstack image show f2758907-89de-4670-bfd1-58e9bd4f61a9

 openstack image set --name cc-rhel-baremetal-packer f2758907-89de-4670-bfd1-58e9bd4f61a9


+------------------+-------------------------------------------------------------------------------------------------+
| Field            | Value                                                                                           |
+------------------+-------------------------------------------------------------------------------------------------+
| checksum         | d41d8cd98f00b204e9800998ecf8427e                                                                |
| container_format | bare                                                                                            |
| created_at       | 2025-08-06T19:30:09Z                                                                            |
| disk_format      | qcow2                                                                                           |
| file             | /v2/images/f2758907-89de-4670-bfd1-58e9bd4f61a9/file                                            |
| id               | f2758907-89de-4670-bfd1-58e9bd4f61a9                                                            |
| min_disk         | 100                                                                                             |
| min_ram          | 0                                                                                               |
| name             | cc-rhel-baremetal-packer                                                                        |
| owner            | dcfb102e7fc940c39c0c21c48d77d3cf                                                                |
| properties       | base_image_ref='', bdm_v2='True', block_device_mapping='[{"tag": null, "no_device": null,       |
|                  | "boot_index": 0, "volume_id": null, "device_type": "disk", "volume_size": 100,                  |
|                  | "destination_type": "volume", "device_name": "/dev/vda", "image_id": null, "source_type":       |
|                  | "snapshot", "snapshot_id": "547c7700-2b20-4829-ae90-1c18f8f12448", "guest_format": null,        |
|                  | "disk_bus": "virtio", "volume_type": null, "delete_on_termination": false}]',                   |
|                  | boot_roles='reader,member,admin,swiftoperator', hw_cdrom_bus='sata', hw_disk_bus='virtio',      |
|                  | hw_input_bus='usb', hw_machine_type='pc-q35-rhel9.0.0', hw_pointer_model='usbtablet',           |
|                  | hw_video_model='virtio', hw_vif_model='virtio', image_type='image', os_hash_algo='sha512', os_h |
|                  | ash_value='cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff83 |
|                  | 18d2877eec2f63b931bd47417a81a538327af927da3e', os_hidden='False', owner_project_name='cc-dev-   |
|                  | oa-chm01-prj', owner_user_name='svc-account-dev-01', root_device_name='/dev/vda',               |
|                  | stores='default_backend'                                                                        |
| protected        | False                                                                                           |
| schema           | /v2/schemas/image                                                                               |
| size             | 0                                                                                               |
| status           | active                                                                                          |
| tags             |                                                                                                 |
| updated_at       | 2025-08-07T03:30:47Z                                                                            |
| visibility       | private                                                                                         |
+------------------+-------------------------------------------------------------------------------------------------+
vsaravan@sjcvl-ghrunner1:~$

Run glance --os-auth-url *** \
+------------------+----------------------------------------------------------------------------------+
| Property         | Value                                                                            |
+------------------+----------------------------------------------------------------------------------+
| checksum         | d41d8cd98f00b204e9800998ecf8427e                                                 |
| container_format | bare                                                                             |
| created_at       | 2025-08-07T03:33:28Z                                                             |
| disk_format      | qcow2                                                                            |
| id               | 6b968d4d-a9be-48d0-a37f-60da50a9761e                                             |
| min_disk         | 100                                                                              |
| min_ram          | 0                                                                                |
| name             | cc-rhel-baremetal-packer                                                         |
| os_hash_algo     | sha512                                                                           |
| os_hash_value    | cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0 |
|                  | ff8318d2877eec2f63b931bd47417a81a538327af927da3e                                 |
| os_hidden        | False                                                                            |
| owner            | ***                                                 |
| protected        | False                                                                            |
| size             | 0                                                                                |
| status           | active                                                                           |
| stores           | default_backend                                                                  |
| tags             | []                                                                               |
| updated_at       | 2025-08-07T03:33:28Z                                                             |
| virtual_size     | Not available                                                                    |
| visibility       | private                                                                          |
+------------------+------------------------------------------------------------


Message
Build of instance 70e9ef6d-f1b5-4550-b6d3-9666629a82d3 aborted: Image 6b968d4d-a9be-48d0-a37f-60da50a9761e is unacceptable: Image not in a supported format
Code
500
Details
Created
Aug. 7, 2025, 12:32 a.m.
Specs




vsaravan@sjcvl-ghrunner1:~$ openstack image show f2758907-89de-4670-bfd1-58e9bd4f61a9 -f json
{
  "checksum": "d41d8cd98f00b204e9800998ecf8427e",
  "container_format": "bare",
  "created_at": "2025-08-06T19:30:09Z",
  "disk_format": "qcow2",
  "file": "/v2/images/f2758907-89de-4670-bfd1-58e9bd4f61a9/file",
  "id": "f2758907-89de-4670-bfd1-58e9bd4f61a9",
  "min_disk": 100,
  "min_ram": 0,
  "name": "cc-rhel-baremetal-packer",
  "owner": "dcfb102e7fc940c39c0c21c48d77d3cf",
  "properties": {
    "os_hidden": false,
    "os_hash_algo": "sha512",
    "os_hash_value": "cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e",
    "base_image_ref": "",
    "owner_user_name": "svc-account-dev-01",
    "owner_project_name": "cc-dev-oa-chm01-prj",
    "boot_roles": "reader,member,admin,swiftoperator",
    "hw_cdrom_bus": "sata",
    "hw_input_bus": "usb",
    "hw_pointer_model": "usbtablet",
    "image_type": "image",
    "root_device_name": "/dev/vda",
    "block_device_mapping": "[{\"tag\": null, \"no_device\": null, \"boot_index\": 0, \"volume_id\": null, \"device_type\": \"disk\", \"volume_size\": 100, \"destination_type\": \"volume\", \"device_name\": \"/dev/vda\", \"image_id\": null, \"source_type\": \"snapshot\", \"snapshot_id\": \"547c7700-2b20-4829-ae90-1c18f8f12448\", \"guest_format\": null, \"disk_bus\": \"virtio\", \"volume_type\": null, \"delete_on_termination\": false}]",
    "bdm_v2": "True",
    "stores": "default_backend",
    "hw_disk_bus": "virtio",
    "hw_machine_type": "pc-q35-rhel9.0.0",
    "hw_video_model": "virtio",
    "hw_vif_model": "virtio"
  },
  "protected": false,
  "schema": "/v2/schemas/image",
  "size": 0,
  "status": "active",
  "tags": [],
  "updated_at": "2025-08-07T03:30:47Z",
  "visibility": "private"









saravan@sjcvl-ghrunner1:~$ openstack image show 6b968d4d-a9be-48d0-a37f-60da50a9761e -f json
{
  "checksum": "d41d8cd98f00b204e9800998ecf8427e",
  "container_format": "bare",
  "created_at": "2025-08-07T03:33:28Z",
  "disk_format": "qcow2",
  "file": "/v2/images/6b968d4d-a9be-48d0-a37f-60da50a9761e/file",
  "id": "6b968d4d-a9be-48d0-a37f-60da50a9761e",
  "min_disk": 100,
  "min_ram": 0,
  "name": "cc-rhel-baremetal-packer",
  "owner": "59c2d928ef6046069a0175d74dc3dc23",
  "properties": {
    "os_hidden": false,
    "os_hash_algo": "sha512",
    "os_hash_value": "cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e",
    "stores": "default_backend"
  },
  "protected": false,
  "schema": "/v2/schemas/image",
  "size": 0,
  "status": "active",
  "tags": [],
  "updated_at": "2025-08-07T03:33:28Z",
  "visibility": "private"

